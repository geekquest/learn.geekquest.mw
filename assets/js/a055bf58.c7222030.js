"use strict";(self.webpackChunklearn_geekquest_mw=self.webpackChunklearn_geekquest_mw||[]).push([[738],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(n),d=r,m=u["".concat(l,".").concat(d)]||u[d]||h[d]||o;return n?a.createElement(m,s(s({ref:t},p),{},{components:n})):a.createElement(m,s({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[u]="string"==typeof e?e:r,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2495:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const o={},s="How to Integrate your web app with the National Bank of Malawi Payment Gateway.",i={unversionedId:"How-to-Integrate-your-web-app-with-the-National-Bank-of-Malawi-Payment-Gateway",id:"How-to-Integrate-your-web-app-with-the-National-Bank-of-Malawi-Payment-Gateway",title:"How to Integrate your web app with the National Bank of Malawi Payment Gateway.",description:"Date : 2023-11-24",source:"@site/docs/How-to-Integrate-your-web-app-with-the-National-Bank-of-Malawi-Payment-Gateway.md",sourceDirName:".",slug:"/How-to-Integrate-your-web-app-with-the-National-Bank-of-Malawi-Payment-Gateway",permalink:"/docs/How-to-Integrate-your-web-app-with-the-National-Bank-of-Malawi-Payment-Gateway",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/How-to-Integrate-your-web-app-with-the-National-Bank-of-Malawi-Payment-Gateway.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Malawian APIs",permalink:"/docs/malawian-apis"}},l={},c=[{value:"Date : 2023-11-24",id:"date--2023-11-24",level:4},{value:"1. Create a folder and the files for the project.",id:"1-create-a-folder-and-the-files-for-the-project",level:2},{value:"2. Create a form for making a payment.",id:"2-create-a-form-for-making-a-payment",level:2},{value:"3. The result and success indicators",id:"3-the-result-and-success-indicators",level:2},{value:"Requesting the hosted checkout interaction",id:"requesting-the-hosted-checkout-interaction",level:2},{value:"4. Define and initiate the payment and interaction data.",id:"4-define-and-initiate-the-payment-and-interaction-data",level:2},{value:"5. Define the interaction.returnUrl.",id:"5-define-the-interactionreturnurl",level:2},{value:"6. Your API Password",id:"6-your-api-password",level:2},{value:"7.  The base url for requesting the checkout session.",id:"7--the-base-url-for-requesting-the-checkout-session",level:2},{value:"7. Extracting the session.id and the success indicator from the curl result.",id:"7-extracting-the-sessionid-and-the-success-indicator-from-the-curl-result",level:2}],p={toc:c},u="wrapper";function h(e){let{components:t,...o}=e;return(0,r.kt)(u,(0,a.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-integrate-your-web-app-with-the-national-bank-of-malawi-payment-gateway"},"How to Integrate your web app with the National Bank of Malawi Payment Gateway."),(0,r.kt)("h4",{id:"date--2023-11-24"},"Date : 2023-11-24"),(0,r.kt)("p",null,"Author : ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/mozesi"},"Moses Msukwa")),(0,r.kt)("p",null,"In this article, I will demonstrate how you can integrate your website with the ",(0,r.kt)("strong",{parentName:"p"},"National Bank of Malawi (NBM) payment gateway")," using the hosted checkout model. The hosted checkout allows a business to collect payments from a customer through an interaction hosted and displayed by the payment Gateway."),(0,r.kt)("p",null,"Below is an illustration of the information flow of the hosted checkout session."),(0,r.kt)("p",null," ",(0,r.kt)("img",{alt:"hosted checkout",src:n(6049).Z,width:"846",height:"429"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The payer initiates the payment process for goods and services at your shop site.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'The payer enters the required information, and clicks "Pay".')),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If the payment is successful, the payer can obtain the payment details from one of these sources: the Payment Gateway-hosted receipt or your shop site."))),(0,r.kt)("p",null,"For simplicity, we will simulate a simple case where a payer wants to pay a merchant. For this, We will need two pages. The first page will be an interface to allow a payer to enter the amount to be paid and the currency for the payment. The second page will handle the actual request of the checkout session upon which the payer will be presented with the payment interface from the gateway."),(0,r.kt)("h2",{id:"1-create-a-folder-and-the-files-for-the-project"},"1. Create a folder and the files for the project."),(0,r.kt)("p",null,"In your web server, create a directory and name it ",(0,r.kt)("strong",{parentName:"p"},"NBAPI"),". We will need two files for this use case. We will need an ",(0,r.kt)("strong",{parentName:"p"},"index.php")," file that will provide an interface to allow a user to enter the desired amount they want to pay."),(0,r.kt)("p",null,"In the second file ",(0,r.kt)("strong",{parentName:"p"},"requestSession.php"),", we will request the checkout session and make the actual payment. In the ",(0,r.kt)("strong",{parentName:"p"},"NBAPI")," directory, create the two files namely ",(0,r.kt)("strong",{parentName:"p"},"index.php")," and ",(0,r.kt)("strong",{parentName:"p"},"requestSession.php"),"."),(0,r.kt)("h2",{id:"2-create-a-form-for-making-a-payment"},"2. Create a form for making a payment."),(0,r.kt)("p",null,"In ",(0,r.kt)("strong",{parentName:"p"},"index.php"),", create a form with two input fields. An input field of the type number for inputing the payable amount and a select field for choosing the desired currency. Below is the code."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'<html lang="en">\n  <head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <title>payment</title>\n    <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/navbar-fixed/">\n <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">\n<meta name="theme-color" content="#7952b3">\n    <link href="navbar-top-fixed.css" rel="stylesheet">\n  </head>\n  <body>\n<nav class="navbar navbar-expand-md fixed-top"  style="background-color:#1e3d11;">\n  <div class="container-fluid">\n    <a class="navbar-brand" href="index.php" style="color:white">Donate</a>\n    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">\n      <span class="navbar-toggler-icon"></span>\n    </button>\n    <div class="collapse navbar-collapse" id="navbarCollapse">\n      <ul class="navbar-nav me-auto mb-2 mb-md-0">\n        <li class="nav-item">\n          <a class="nav-link active" aria-current="page" href="index.php" style="color:white"><b>Pay</b></a>\n        </li>\n      </ul>\n    </div>\n  </div>\n</nav>\n   <br>\n   <main class="container">\n  <div class="bg-light p-5 rounded">                      \n        <form class="col-md-4" action="requestSession.php" method="POST">\n            <div  class="row mb-3">\n                <label for="currency" class="form-label">Select Currency</label><br>\n                    <select type="text" id="curreny" class="form-select" name="currency"required>\n                        <option value="USD">USD</option>\n                        <option selected value="MWK">MWK</option>\n                    </select>\n            </div>\n            <div  class="row mb-4">\n                <label for="amount" class="form-label">Enter Amount</label><br>\n                    <input type="number" class="form-control" id="amount" name="amount"  min="5" required>\n            </div>             \n            <div class="col-12">\n                <button class="btn btn-lg btn-primary" type="submit" role="button">Donate Now &raquo;</button>\n            </div>\n        </form>\n  </div>\n</main>\n    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"><\/script>\n</html>\n')),(0,r.kt)("h2",{id:"3-the-result-and-success-indicators"},"3. The result and success indicators"),(0,r.kt)("p",null,"We need to retrieve the result indicator and success indicators. The result indicator will automatically be returned by the gateway via the ",(0,r.kt)("strong",{parentName:"p"},"return URL")," which we will define in ",(0,r.kt)("strong",{parentName:"p"},"step 5"),". Upon requesting the checkout session, the gateway will return the success indicator which we will store through a session variable. (Note that this can be stored in your system database.)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'<?php\nsession_start();\n$resultIndicator  = $_GET["resultIndicator"];\n$successIndicator = $_SESSION["successIndicator"];\n?>\n')),(0,r.kt)("p",null,"A match of the ",(0,r.kt)("strong",{parentName:"p"},"$successIndicator")," and the ",(0,r.kt)("strong",{parentName:"p"},"$resultIndicator")," indicates that the payment was successful."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'<?php\n       if(isset($resultIndicator)& isset($successIndicator))\n       {\n          if($resultIndicator == $successIndicator){\n              echo "The payment was succesfull";           \n      }    \n?>\n\n')),(0,r.kt)("h2",{id:"requesting-the-hosted-checkout-interaction"},"Requesting the hosted checkout interaction"),(0,r.kt)("p",null,"In ",(0,r.kt)("strong",{parentName:"p"},"requestSession.php")," we need to request the checkout session using the Create Checkout Session operation. The request should include the payment, interaction data and the completion instructions."),(0,r.kt)("h2",{id:"4-define-and-initiate-the-payment-and-interaction-data"},"4. Define and initiate the payment and interaction data."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'<?php\nsession_start();\nif( $_POST["currency"] || $_POST["amount"] ) {   \n$amount = $_POST[\'amount\'];\n$currency = $_POST[\'currency\'];\n$reference = uniqid();\n$orderId   = uniqid();\n$apiUsername ="apiUsername";\n$merchant ="MerchatId";\n')),(0,r.kt)("h2",{id:"5-define-the-interactionreturnurl"},"5. Define the interaction.returnUrl."),(0,r.kt)("p",null,"As pre-empted in ",(0,r.kt)("strong",{parentName:"p"},"step 3"),", the gateway will need the ",(0,r.kt)("strong",{parentName:"p"},"$returnUrl")," to redirect the payer after the checkout session. Possibly, when redirected the payer can be  presented with the payment status or any desired message including a receipt."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'$returnUrl = "https://returnurl.com";\n')),(0,r.kt)("h2",{id:"6-your-api-password"},"6. Your API Password"),(0,r.kt)("p",null,"You should generate the API password in the Merchant Administration Portal. Administrator login credentials are provided to you by NBM when you are successfully on boarded on the gateway as a merchant. As an administrator, you will need to create a new operator with permissions to generate the API password."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'$apiPassword ="yourMerchantPortalGeneratedApiPassword";\n')),(0,r.kt)("h2",{id:"7--the-base-url-for-requesting-the-checkout-session"},"7.  The base url for requesting the checkout session."),(0,r.kt)("p",null,"You will be provided with the base url for the test environment for testing purposes. You will then switch to a production base url."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'$baseUrl =  "https://nbm.gateway.mastercard.com/api/nvp/version/49";\n\n')),(0,r.kt)("p",null,"Then we need to Initiate a curl with the Create Checkout Session operation. As ealier indicated, this request should include the payment and the interaction data, plus the completion instructions. we have already defined the needed parameters from ",(0,r.kt)("strong",{parentName:"p"},"step 4"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'$ch = curl_init();\ncurl_setopt($ch, CURLOPT_URL,$baseUrl);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER,1);\ncurl_setopt($ch, CURLOPT_POST,1);\ncurl_setopt($ch, CURLOPT_POSTFIELDS,\n"apiOperation=".$apiOperation."&apiPassword=".$apiPassword."&transaction.reference=".$reference."&interaction.returnUrl=".$returnUrl."&apiUsername=".$apiUsername."&merchant=".$merchant."&order.id=".$orderId."&order.amount=".$amount."&order.currency=".$currency);\n$headers = array();\n$headers[] = \'Content-Type: application/x-www-form-urlencoded\';\ncurl_setopt($ch, CURLOPT_HTTPHEADER, $headers);\n$result = curl_exec($ch);\nif(curl_errno($ch)){\n    echo \'ERROR:\'.curl_error($ch);\n}\ncurl_close($ch);\n')),(0,r.kt)("h2",{id:"7-extracting-the-sessionid-and-the-success-indicator-from-the-curl-result"},"7. Extracting the session.id and the success indicator from the curl result."),(0,r.kt)("p",null,"A successful response in ",(0,r.kt)("strong",{parentName:"p"},"step 7")," will contain the session.id and the success Indicator parameters.\nthe result indicator and success indicators"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'$sessionid = explode("=",explode("&",$result)[2])[1];\n$successIndicator = explode("=",explode("&",$result)[5])[1];\n')),(0,r.kt)("p",null,"You may be wondering why the success Indicator."),(0,r.kt)("p",null,"The gateway sends the result of the payment in a ",(0,r.kt)("strong",{parentName:"p"},"resultIndicator")," parameter, via the return url (interaction.returnUrl) used to return the payer to your desired page. You can determine the success of the payment by comparing the values of ",(0,r.kt)("strong",{parentName:"p"},"resultIndicator")," and the ",(0,r.kt)("strong",{parentName:"p"},"successIndicator"),"."),(0,r.kt)("p",null,"A match of the ",(0,r.kt)("strong",{parentName:"p"},"successIndicator")," and the ",(0,r.kt)("strong",{parentName:"p"},"resultIndicator")," shows that the payment was successful. Depending on you system use case, you can then save the value returned in the successIndicator parameter on your system to verify the success or failure of the payment. "),(0,r.kt)("p",null,"Here We will use sessions just to demonstrate the point as explained."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'$_SESSION["successIndicator"] = $successIndicator;\n$_SESSION["amount"] = $amount ;\n$_SESSION["currency"] = $currency;\n\n')),(0,r.kt)("p",null,"Include the below code for the page structure and the payment request form."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'<!doctype html>\n<html lang="en">\n  <head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <meta name="description" content="">\n    <title>your name</title>\n    <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/navbar-fixed/">\n    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">\n    <link href="navbar-top-fixed.css" rel="stylesheet">\n  </head>\n  <body>\n    <nav class="navbar navbar-expand-md fixed-top"  style="background-color:#1e3d11;">\n      <div class="container-fluid">\n        <a class="navbar-brand" href="#" style="color:white">Your site</a>\n        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">\n          <span class="navbar-toggler-icon"></span>\n        </button>\n        <div class="collapse navbar-collapse" id="navbarCollapse">\n          <ul class="navbar-nav me-auto mb-2 mb-md-0">\n            <li class="nav-item">\n              <a class="nav-link active" aria-current="page" href="#" style="color:white"><b>Your site</b></a>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </nav>\n   <br>\n   <main class="container">\n  <div class="bg-light p-5 rounded">\n    <p class="lead">Make your payment.</p>\n    <div class="form-group">\n            <div class="col-xs-8">\n            <label for="amount">Confirm a payment of <?php echo $currency.$amount;?>. </label>\n            <br>\n            <br>\n\n            <input type="button" maxlength="5" maxheight="2" class="btn btn-primary btn-lg" value="Pay" onclick="Checkout.showPaymentPage();" />\n            </div>\n            </div>\n    </div>\n</main>\n')),(0,r.kt)("p",null,"We then need to reference the ",(0,r.kt)("strong",{parentName:"p"},"checkout.js")," file from the gateway servers. This will place the Checkout object into global scope. In this case we will use ",(0,r.kt)("strong",{parentName:"p"},"version 49")," of the checkout."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},' <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"><\/script> \n <script src="https://nbm.gateway.mastercard.com/checkout/version/49/checkout.js" data-error="errorCallback" data-cancel="cancelCallback"><\/script>\n')),(0,r.kt)("p",null,"We need some JavaScript to finalize the process. we need a call to the Checkout.configure() function and then pass in a JSON object that includes the returned session.id and other payment request parameters to pass in the necessary data for the payment."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"        <script type=\"text/javascript\">\n            function errorCallback(error) {\n                  console.log(JSON.stringify(error));\n            }\n            function cancelCallback() {\n                  console.log('Payment cancelled');\n            }\n            Checkout.configure({\n                merchant: 'MECHARNTID',\n                order: {\n                    id: '<?php echo $orderId;  ?>' ,\n                    amount: '<?php echo $amount;  ?>' ,\n                    currency: '<?php echo $currency;  ?>',\n                    description: 'description',\n                },\n                session:{\n                    id:'<?php echo $sessionid; ?>'\n                },\n                 interaction:{\n                    merchant: {\n                        name: 'NAME ',\n                        address: {\n                            line1: 'YOUR ADDRESS',\n                            line2: 'YOUR POST BOX'            \n                        }    \n                    }\n                  }\n            });\n        <\/script>   \n <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js\" integrity=\"sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj\" crossorigin=\"anonymous\"><\/script>\n</html>\n")),(0,r.kt)("p",null,"There we go! we have the simple integration to the payment gateway."),(0,r.kt)("p",null,"You can get more details on how to access the payment API from ",(0,r.kt)("a",{parentName:"p",href:"https://www.natbank.co.mw/"},"National Bank of Malawi ")," and  more information on the API ",(0,r.kt)("a",{parentName:"p",href:"https://test-nbm.mtf.gateway.mastercard.com/api/documentation/integrationGuidelines/index.html?locale=en_US"},"here"),"."))}h.isMDXComponent=!0},6049:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/hosted-eeab2783e5640fb4b010a2011fa1786b.png"}}]);